<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Proyecto Navidad</title>
    <link rel="stylesheet" href="css/style.css" />

    <style>
      /* Estilos base del admin (no los de la app principal) */
      body {
        background-color: #121212 !important;
        background-image: none !important;
        color: #eee;
        overflow-y: auto;
      }
      #app-root {
        max-width: 1200px;
        justify-content: flex-start;
        padding-top: 2rem;
      }
    </style>
  </head>
  <body>
    <main id="app-root">
      <div id="admin-login" class.is-loading"controles">
        <h1 class="titulo" style="opacity: 1; font-size: 2.5rem">
          Panel de Administración
        </h1>
        <p class="narrativa">
          Debes iniciar sesión con Google para ver el progreso.
        </p>
        <div class="acciones">
          <button id="login-btn" class.is-loading"admin-button-google">
            <svg aria-hidden="true" height="20" viewBox="0 0 18 18" width="20">
              <path
                d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6c1.5-1.38 2.36-3.25 2.36-5.05 0-.73-.06-1.45-.17-2.05z"
                fill="#fff"
              ></path>
              <path
                d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2c-.74.5-1.66.8-2.7.8-2.08 0-3.84-1.38-4.48-3.24H1.88v2.07C3.3 15.18 5.92 17 8.98 17z"
                fill="#fff"
              ></path>
              <path
                d="M4.5 10.52c-.17-.5-.28-1.04-.28-1.54s.11-1.04.28-1.54V5.38H1.88C1.35 6.45.96 7.68.96 8.98c0 1.3.39 2.53 1.04 3.62l2.5-2.08z"
                fill="#fff"
              ></path>
              <path
                d="M8.98 4.8c1.17 0 2.23.4 3.06 1.2l2.3-2.3C12.95 2.04 11.11 1 8.98 1 5.92 1 3.3 2.82 1.88 5.38l2.62 2.06C5.14 5.63 6.9 4.8 8.98 4.8z"
                fill="#fff"
              ></path>
            </svg>
            Iniciar Sesión con Google
          </button>
        </div>
      </div>

      <div id="admin-panel" class="hidden-content">
        <div class="admin-header">
          <h1 class="titulo" style="opacity: 1; margin: 0">
            Progreso de Valentino
          </h1>
          <div class="admin-usuario-info">
            <span id="admin-user-email"></span>
            <button id="logout-btn" class.is-loading"admin-button-logout">
              Cerrar Sesión
            </button>
          </div>
        </div>

        <hr class="admin-divider" />

        <div class="admin-main-container">
          <div class="admin-column" id="path-container">
            <h2 class.is-loading"admin-column-title">Mapa de Progreso</h2>
            <div id="visual-path"></div>
          </div>

          <div class="admin-column" id="details-container">
            <h2 class.is-loading"admin-column-title">Estado Actual</h2>
            <div class.is-loading"admin-user-card" id="details-cards"></div>

            <h2 class="admin-column-title" style="margin-top: 2rem">
              Registro de Intentos
            </h2>
            <div class.is-loading"admin-user-card" style="margin-top: 0">
              <ul class.is-loading"admin-attempts-list" id="attempts-list">
                <li>Cargando intentos...</li>
              </ul>
            </div>

            <div class.is-loading"admin-danger-zone">
              <h2 class.is-loading"admin-column-title">Zona Peligrosa</h2>
              <button
                id="delete-progress-btn"
                class="admin-button-delete"
                disabled
              >
                Reiniciar Progreso del Usuario
              </button>
            </div>

            <div
              class="admin-danger-zone"
              style="
                margin-top: 1rem;
                border-top: 1px solid var(--admin-border);
                padding-top: 1rem;
              "
            >
              <h2 class.is-loading"admin-column-title">
                Zona de Pruebas (Control Remoto)
              </h2>
              <p
                class="narrativa"
                style="
                  font-size: 0.9rem;
                  text-align: left;
                  margin-bottom: 1rem;
                  color: var(--admin-text-secondary);
                "
              >
                Este botón desbloqueará el botón "Siguiente" en la sección
                'pausa' para el usuario (Valentino) en tiempo real, ignorando la
                fecha.
              </p>

              <button
                id="force-pausa-unlock-btn"
                class="admin-button-google"
                style="
                  text-decoration: none;
                  background-color: var(--admin-accent-green);
                  width: 100%;
                  justify-content: center;
                  font-size: 1rem;
                "
                disabled
              >
                Forzar Desbloqueo de Pausa (Remoto)
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
      
      import {
        getAuth,
        onAuthStateChanged,
        GoogleAuthProvider,
        signInWithPopup,
        signInWithRedirect, 
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

      import {
        getFirestore,
        doc,
        collection,
        onSnapshot,
        query,
        orderBy,
        getDocs,
        deleteDoc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

      // 1. Se define el objeto SDK
      window.firebaseAdminSDK = {
        initializeApp,
        getAuth,
        onAuthStateChanged,
        GoogleAuthProvider,
        signInWithPopup, // <-- Exportamos la función de Popup
        signInWithRedirect,
        signOut,
        getFirestore,
        doc,
        collection,
        onSnapshot,
        query,
        orderBy,
        getDocs,
        deleteDoc,
        setDoc,
        
        firebaseConfig: {
          apiKey: "AIzaSyBAv3HFQifOmS78tRYvo8yM4Um_PX0d_sk",
          authDomain: "regalonavidad-9304b.firebaseapp.com",
          projectId: "regalonavidad-9304b",
          storageBucket: "regalonavidad-9304b.firebasestorage.app",
          messagingSenderId: "920626025677",
          appId: "1:920626025677:web:ee800a9860410818fc0584"
        }
      };

      // 2. Se importa admin.js DESPUÉS de que el objeto esté definido
      import "./js/admin.js";

    </script>
    </body>
</html>